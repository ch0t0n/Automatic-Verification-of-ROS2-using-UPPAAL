<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE nta PUBLIC '-//Uppaal Team//DTD Flat System 1.1//EN' 'http://www.it.uu.se/research/group/darts/uppaal/flat-1_2.dtd'>
<nta>
	<declaration>// Place global declarations here.

chan p1, p2, p3, s1, s2;
const int nsub1 = 5, nsub2 = 3;
const int r1 = 2, r2 = 3;
const int ds1=1, ds2=4;

int As1[5];
int As2[5];

int os1=0, os2=0, cs1=0, cs2=0;

void enqueue(int &amp;A[5], int n, int &amp;cs, int &amp;os, int p) {
    if (cs == n){
        int i;        
        for (i=0; i&lt;=n-2; i++){
            A[i] = A[i+1];
        }
        A[n-1] = p;
        os = 1-os;
    }
    else {
        A[cs] = p;
        cs++;
    }
}

void dequeue(int &amp;A[5], int n, int &amp;cs) {    
    int i;
    if (cs == 1){
        A[0] = 0;
    }
    if (cs &gt; 1) {
        for (i=0; i&lt;=cs-2; i++){
            A[i] = A[i+1];
        }
        A[cs-1] = 0;
    }
    cs--;
    if (cs &lt; 0){
        cs = 0;
    }
}
    


</declaration>
	<template>
		<name x="5" y="5">pub1</name>
		<declaration>// Place local declarations here.
clock t;</declaration>
		<location id="id0" x="-552" y="-773">
			<name x="-561" y="-756">initp1</name>
			<label kind="invariant" x="-561" y="-739">t&lt;=r1</label>
		</location>
		<init ref="id0"/>
		<transition>
			<source ref="id0"/>
			<target ref="id0"/>
			<label kind="guard" x="-578" y="-918">t==r1</label>
			<label kind="synchronisation" x="-569" y="-901">p1!</label>
			<label kind="assignment" x="-578" y="-884">t=0</label>
			<nail x="-493" y="-858"/>
			<nail x="-612" y="-858"/>
		</transition>
	</template>
	<template>
		<name>pub2</name>
		<declaration>clock t;</declaration>
		<location id="id1" x="-544" y="-102">
			<name x="-553" y="-85">initp2</name>
			<label kind="invariant" x="-553" y="-68">t&lt;=r2</label>
		</location>
		<init ref="id1"/>
		<transition>
			<source ref="id1"/>
			<target ref="id1"/>
			<label kind="guard" x="-561" y="-246">t==r2</label>
			<label kind="synchronisation" x="-561" y="-229">p2!</label>
			<label kind="assignment" x="-561" y="-212">t=0</label>
			<nail x="-485" y="-187"/>
			<nail x="-604" y="-187"/>
		</transition>
	</template>
	<template>
		<name>pub3</name>
		<declaration>clock t;</declaration>
		<location id="id2" x="-348" y="-204">
			<name x="-374" y="-187">initp3</name>
		</location>
		<location id="id3" x="-144" y="-204">
			<name x="-119" y="-204">received</name>
			<label kind="invariant" x="-119" y="-221">t&lt;=0</label>
		</location>
		<init ref="id2"/>
		<transition>
			<source ref="id3"/>
			<target ref="id2"/>
			<label kind="synchronisation" x="-263" y="-280">p3!</label>
			<nail x="-255" y="-255"/>
		</transition>
		<transition>
			<source ref="id2"/>
			<target ref="id3"/>
			<label kind="synchronisation" x="-255" y="-161">s2?</label>
			<label kind="assignment" x="-255" y="-144">t:=0</label>
			<nail x="-238" y="-161"/>
		</transition>
	</template>
	<template>
		<name>sub1</name>
		<declaration>clock t;</declaration>
		<location id="id4" x="-323" y="-323">
			<name x="-382" y="-348">inits1</name>
			<label kind="invariant" x="-382" y="-331">t&lt;=ds1</label>
		</location>
		<init ref="id4"/>
		<transition>
			<source ref="id4"/>
			<target ref="id4"/>
			<label kind="guard" x="-212" y="-349">t==ds1</label>
			<label kind="assignment" x="-212" y="-314">t=0, dequeue(As1,nsub1, cs1)</label>
			<nail x="-221" y="-247"/>
			<nail x="-229" y="-391"/>
		</transition>
	</template>
	<template>
		<name>sub2</name>
		<declaration>clock t;</declaration>
		<location id="id5" x="-178" y="-204">
			<name x="-229" y="-221">inits2</name>
			<label kind="invariant" x="-238" y="-204">t&lt;=ds2</label>
		</location>
		<init ref="id5"/>
		<transition>
			<source ref="id5"/>
			<target ref="id5"/>
			<label kind="guard" x="-76" y="-238">t==ds2</label>
			<label kind="synchronisation" x="-75" y="-225">s2!</label>
			<label kind="assignment" x="-75" y="-208">t=0, dequeue(As2,nsub2, cs2)</label>
			<nail x="-85" y="-136"/>
			<nail x="-93" y="-280"/>
		</transition>
	</template>
	<template>
		<name>top1</name>
		<location id="id6" x="-153" y="-195">
			<name x="-144" y="-238">initt1</name>
		</location>
		<init ref="id6"/>
		<transition>
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-212" y="-263">p3?</label>
			<label kind="assignment" x="-331" y="-280">enqueue(As1, nsub1, cs1, os1, 3), enqueue(As2, nsub2, cs2, os2, 3)</label>
			<nail x="-229" y="-221"/>
			<nail x="-153" y="-263"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-178" y="-136">p2?</label>
			<label kind="assignment" x="-340" y="-119">enqueue(As1, nsub1, cs1, os1, 2), enqueue(As2, nsub2, cs2, os2, 2)</label>
			<nail x="-127" y="-127"/>
			<nail x="-212" y="-178"/>
		</transition>
		<transition>
			<source ref="id6"/>
			<target ref="id6"/>
			<label kind="synchronisation" x="-85" y="-212">p1?</label>
			<label kind="assignment" x="-85" y="-195">enqueue(As1, nsub1, cs1, os1, 1), enqueue(As2, nsub2, cs2, os2, 1)</label>
			<nail x="-93" y="-170"/>
			<nail x="-93" y="-229"/>
		</transition>
	</template>
	<system>// Place template instantiations here.
Processpub1 = pub1();
Processpub2 = pub2();
Processpub3 = pub3();
Processsub1 = sub1();
Processsub2 = sub2();
Processtop1 = top1();

// List one or more processes to be composed into a system.
system Processpub1, Processpub2, Processpub3, Processsub1, Processsub2, Processtop1;
    </system>
	<queries>
		<query>
			<formula>A[](cs1&lt;5)

</formula>
			<comment>"The queue in subscriber 1 is never full"</comment>
		</query>
		<query>
			<formula>A&lt;&gt;(cs1==5)
</formula>
			<comment>"The queue of subscriber 1 will eventually become full"</comment>
		</query>
		<query>
			<formula>A&lt;&gt;(exists (i : int[0,4]) As1[i]==2)
</formula>
			<comment>"The subscriber 1 will eventually receive a value from publisher 2"</comment>
		</query>
		<query>
			<formula>[][0,2](os1==0 &amp;&amp; os2==0)</formula>
			<comment>No message is lost</comment>
		</query>
	</queries>
</nta>
